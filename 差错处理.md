**1.登陆**
user_id, password, role
查询数据库，存在则成功，否则简单返回失败

### 学生

**2.请求可选课程**
浏览所有可选课程 ( student id )
1.选课时间在 section 的 deadline 之前
2.选课人数 < max_capacity
3.先修课已经通过
4.该课未被选过，或者未及格 
5.时间冲突交给cpp
6.学院这个条件允许：

- 本学院的所有课程
- 跨学院的通识必修课（'General Required'）和全校任选课（'University Elective'）

**3.提交选课申请** 已加

改正了之后
![image-20251008153240095](Z:\电子书\操作系统\mages\image-20251008153240095.png)

错误1. 时间冲突
用三维bool数组检测20周，7天，8节课 timetable **[22] [8] [9]**
先读取该学生的三维课表

```mysql
SELECT 
	s.start_week,
	s.end_week,
	s.time_slot
FROM enrollments e
JOIN sections s USING (section_id)
WHERE e.student_id = 1 AND 
	e.status = 'Enrolling';
```

![image-20251008150950343](Z:\电子书\操作系统\mages\image-20251008150950343.png)

错误2. 人数冲突

错误3. 超过选课时间

**4. 学生退课** 无

**5. 查看学生课表**
semester=2025春 学期格式错误？已加

**6. 查询学生成绩**

**7. 查gpa**

**8. 个人信息查询**

**9. 个人信息修改** 已加

```
  birthday: "2005-06-27",
  email: "baobaobus@gmail.com",
  phone: "18923108045",
  password: "aasfaasfdasff666"
```

```cpp
#define _CRT_SECURE_NO_WARNINGS
#include <iostream>
#include <string>
#include <regex>
#include <sstream>
#include <vector>
#include <cstdio>

class DataValidator {
private:
    // 正则表达式模式
    static const std::regex EMAIL_REGEX;
    static const std::regex PHONE_REGEX;
    static const std::regex DATE_REGEX;
    static const std::regex PASSWORD_REGEX;

public:
    // 验证邮箱格式
    static bool isValidEmail(const std::string& email) {
        return std::regex_match(email, EMAIL_REGEX);
    }

    // 验证手机号格式 (中国手机号)
    static bool isValidPhone(const std::string& phone) {
        return std::regex_match(phone, PHONE_REGEX);
    }

    // 验证日期格式 (YYYY-MM-DD)
    static bool isValidDate(const std::string& date) {
        // 先用正则验证基本格式
        if (!std::regex_match(date, DATE_REGEX)) {
            return false;
        }

        // 使用sscanf安全解析日期
        int year, month, day;
        if (sscanf(date.c_str(), "%d-%d-%d", &year, &month, &day) != 3) {
            return false;
        }

        // 进一步验证日期有效性
        return isValidDateValues(year, month, day);
    }

    // 验证密码强度
    static bool isValidPassword(const std::string& password) {
        if (password.length() < 8) {
            return false; // 密码长度至少8位
        }
        return std::regex_match(password, PASSWORD_REGEX);
    }

    // 验证所有字段
    static bool validateAll(const std::string& birthday, const std::string& email,
        const std::string& phone, const std::string& password) {
        return isValidDate(birthday) &&
            isValidEmail(email) &&
            isValidPhone(phone) &&
            isValidPassword(password);
    }

private:
    // 验证日期值的有效性
    static bool isValidDateValues(int year, int month, int day) {
        // 检查基本范围
        if (year < 1900 || year > 2100) return false;
        if (month < 1 || month > 12) return false;
        if (day < 1 || day > 31) return false;

        // 各月份天数
        int daysInMonth[] = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };

        // 闰年处理
        if (month == 2 && isLeapYear(year)) {
            daysInMonth[1] = 29;
        }

        return day <= daysInMonth[month - 1];
    }

    static bool isLeapYear(int year) {
        return (year % 4 == 0 && year % 100 != 0) || (year % 400 == 0);
    }
};

// 初始化静态正则表达式成员
const std::regex DataValidator::EMAIL_REGEX(R"(^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$)");
const std::regex DataValidator::PHONE_REGEX(R"(^1[3-9]\d{9}$)"); // 中国手机号
const std::regex DataValidator::DATE_REGEX(R"(^\d{4}-\d{2}-\d{2}$)");
const std::regex DataValidator::PASSWORD_REGEX(R"(^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{8,}$)");

// 使用示例
int main() {
    std::string birthday = "2005-06-27";
    std::string email = "baobaobus@gmail.com";
    std::string phone = "18923108045";
    std::string password = "aasfaasfdasff666";

    // 逐个验证
    std::cout << "生日验证: " << (DataValidator::isValidDate(birthday) ? "通过" : "失败") << std::endl;
    std::cout << "邮箱验证: " << (DataValidator::isValidEmail(email) ? "通过" : "失败") << std::endl;
    std::cout << "手机号验证: " << (DataValidator::isValidPhone(phone) ? "通过" : "失败") << std::endl;
    std::cout << "密码验证: " << (DataValidator::isValidPassword(password) ? "通过" : "失败") << std::endl;

    // 整体验证
    if (DataValidator::validateAll(birthday, email, phone, password)) {
        std::cout << "所有数据格式正确!" << std::endl;
    }
    else {
        std::cout << "存在格式错误的数据!" << std::endl;
    }

    // 测试一些边界情况
    std::cout << "\n测试边界情况:" << std::endl;
    std::cout << "无效日期(2005-13-27): " << DataValidator::isValidDate("2005-13-27") << std::endl;
    std::cout << "无效邮箱(baobaobus): " << DataValidator::isValidEmail("baobaobus") << std::endl;
    std::cout << "无效手机号(123456): " << DataValidator::isValidPhone("123456") << std::endl;
    std::cout << "短密码(123): " << DataValidator::isValidPassword("123") << std::endl;

    return 0;
}
```



### 教师

**1. 教授查看课表**
semester=2025春 已写

**2.老师所教的课程中所有学生的成绩查看**
没录入返回-1

**3.录入成绩(id在2中已知)**

**4. 个人信息**

**5. 个人信息修改**（复用学生代码）已加

```
college: "计算机工程",
email: "baobaobus@gmail.com",
phone: "18923108045",
password: "aasfaasfdasff666"
```

### 管理员

**1.获得某种角色的所有账号信息**
role=student 错误

**2.删除某些账号** 已加
role错误，user_id 一般不会出错

**3.增加某个账号** (改动传major_id) 已加
role （student，teacher）错误
name 过长
gender （男/女）错误
grade 大小(2000-2100)
老师 name 过长
college_id

**4.获取某学期所有课程**
?semester=2025春 ‘2025春’格式错误

**5.删除某些课程**
只能删除当前学期的课程，在cpp中判断

**6.增加课程**
6.1 旧course
semester ’2025春‘格式错误
type 格式错误，general required，major required，major elective， university elective， practical
schedule {day, time} 格式错误
max_capacity 太小
startWeek 和 endWeek （1-20）
location 限制格式 A?-??? or B?-??? ?是数字

6.2
和上面相比多了
college_id
course_name 长度限制
credit 只能是正整数，且<=7
type 格式错误，general required，major required，major elective， university elective， practical

**7.改变课程的信息**
schedule {day, time} 格式错误
startWeek 和 endWeek （1-20）

**8. 获取课程的成绩分布**

student_id=5484 id不存在
semester=2025春 格式错误

teacher_id=546 教授id不存在
semester=2025春 格式错误

**11.获取所有的学院信息**

**12.获取某个学院的所有课程信息**

**13.获取某个学院的所有老师信息**

